<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>Trading Bot Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#0a0a0a; color:#fff; font-family:Arial; text-align:center; }
    .signal { font-size:48px; font-weight:bold; margin:20px; text-shadow:0 0 20px #0ff; }
    .buy { color:#00ff00; text-shadow:0 0 20px #00ff00; }
    .sell { color:#ff4444; text-shadow:0 0 20px #ff4444; }
    .none { color:#aaa; }
    .stats { margin:20px; font-size:18px; }
    .history { margin:20px auto; width:300px; text-align:left; background:#111; border:1px solid #333; padding:10px; border-radius:8px; }
    .btn { background:#111; border:1px solid #0ff; color:#0ff; padding:8px 12px; margin:5px; cursor:pointer; border-radius:6px; }
    .btn:hover { background:#0ff; color:#000; }
    #timer { margin:10px; font-size:16px; color:#0ff; }
    .panel { margin:20px auto; width:80%; }
  </style>
</head>
<body>
  <h1>‚ö° Trading Bot Pro ‚ö°</h1>
  <div>
    {% for a in assets %}
      <button class="btn" onclick="changeAsset('{{a}}')">{{a}}</button>
    {% endfor %}
    <button class="btn" onclick="loadData()">üîÑ –û–±–Ω–æ–≤–∏</button>
  </div>
  <div id="signal" class="signal none">---</div>
  <div class="stats" id="stats"></div>
  <div id="timer">–û–±–Ω–æ–≤—è–≤–∞–Ω–µ —Å–ª–µ–¥: 60 —Å–µ–∫.</div>

  <!-- Pocket Option –±—É—Ç–æ–Ω -->
  <div class="panel">
    <h2 style="color:#0ff;">Pocket Option</h2>
    <button class="btn" onclick="openPocket()">–û—Ç–≤–æ—Ä–∏ Pocket Option</button>
  </div>

  <!-- –¶–µ–Ω–∞ + EMA -->
  <div class="panel"><canvas id="priceChart"></canvas></div>
  <!-- RSI -->
  <div class="panel"><canvas id="rsiChart"></canvas></div>
  <!-- MACD -->
  <div class="panel"><canvas id="macdChart"></canvas></div>
  <!-- ATR -->
  <div class="panel"><canvas id="atrChart"></canvas></div>

  <div class="history">
    <h3>–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ —Å–∏–≥–Ω–∞–ª–∏—Ç–µ</h3>
    <ul id="history"></ul>
  </div>

  <script>
    let priceChart = new Chart(document.getElementById('priceChart'), {
      type:'line', data:{labels:[],datasets:[
        {label:'–¶–µ–Ω–∞',data:[],borderColor:'#0ff'},
        {label:'EMA5',data:[],borderColor:'#0f0'},
        {label:'EMA20',data:[],borderColor:'#f00'}
      ]}, options:{plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}
    });

    let rsiChart = new Chart(document.getElementById('rsiChart'), {
      type:'line', data:{labels:[],datasets:[{label:'RSI',data:[],borderColor:'#ff0'}]},
      options:{plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'}},y:{min:0,max:100,ticks:{color:'#fff'}}}}
    });

    let macdChart = new Chart(document.getElementById('macdChart'), {
      type:'line', data:{labels:[],datasets:[
        {label:'MACD',data:[],borderColor:'#0ff'},
        {label:'Signal',data:[],borderColor:'#ff0'}
      ]}, options:{plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}
    });

    let atrChart = new Chart(document.getElementById('atrChart'), {
      type:'line', data:{labels:[],datasets:[{label:'ATR',data:[],borderColor:'#f0f'}]},
      options:{plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}
    });

    let asset = "{{assets[0]}}";
    let timer = 60;

    async function loadData() {
      let res = await fetch(`/api/signal?asset=${asset}`);
      let data = await res.json();

      let s=document.getElementById("signal");
      s.textContent=data.signal;
      s.className="signal " + (data.signal==="BUY"?"buy":data.signal==="SELL"?"sell":"none");

      document.getElementById("stats").textContent=
        `–ê–∫—Ç–∏–≤: ${data.asset} | Win: ${data.stats.win} | Loss: ${data.stats.loss} | Accuracy: ${data.stats.accuracy}`;

      let hist=document.getElementById("history"); hist.innerHTML="";
      data.history.forEach(h=>{let li=document.createElement("li");li.textContent=h;hist.appendChild(li);});

      priceChart.data.labels=rsiChart.data.labels=macdChart.data.labels=atrChart.data.labels=data.chart.labels;
      priceChart.data.datasets[0].data=data.chart.close;
      priceChart.data.datasets[1].data=data.chart.ema5;
      priceChart.data.datasets[2].data=data.chart.ema20;
      rsiChart.data.datasets[0].data=data.chart.rsi;
      macdChart.data.datasets[0].data=data.chart.macd;
      macdChart.data.datasets[1].data=data.chart.macd_signal;
      atrChart.data.datasets[0].data=data.chart.atr;
      priceChart.update(); rsiChart.update(); macdChart.update(); atrChart.update();
    }

    function changeAsset(a){ asset=a; loadData(); }
    function openPocket(){ window.open("https://pocketoption.com", "_blank", "width=1200,height=800"); }

    setInterval(()=>{timer--; if(timer<=0){timer=60;loadData();} document.getElementById("timer").textContent=`–û–±–Ω–æ–≤—è–≤–∞–Ω–µ —Å–ª–µ–¥: ${timer} —Å–µ–∫.`;},1000);

    loadData();
  </script>
</body>
</html>
